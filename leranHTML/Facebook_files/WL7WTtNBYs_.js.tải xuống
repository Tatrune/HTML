if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("LSDatabase",[],(function(a,b,c,d,e,f){}),null);
__d("LSTableDefaults",[],(function(a,b,c,d,e,f){e.exports={sync_groups:{syncStatus:[0,0],sendSyncParams:!1,minTimeToSyncTimestampMs:[0,0],canIgnoreTimestamp:!1,priority:[0,0],lastSyncRequestTimestampMs:[0,0],lastSyncCompletedTimestampMs:[0,0],syncChannel:[0,1]},pending_tasks:{enqueueTimestampMs:[0,0],firstExecutedTimestampMs:[0,0],failureCount:[0,0],minTimeToSyncTimestampMs:[0,0],pluginType:[0,0],priority:[0,0]},pending_fire_and_forget_tasks:{enqueueTimestampMs:[0,0],priority:[0,0]},contacts:{isMessengerUser:!1,isMemorialized:!1,blockedByViewerStatus:[0,0],rank:[0,0],contactType:[0,0],contactTypeExact:[0,0],canViewerMessage:!0,gender:[0,0],authorityLevel:[0,0],optimisticBlockedByViewerStatus:[0,0],optimisticBlockedByViewerStatusTimestampMs:[0,0],contactReachabilityStatusType:[0,0],restrictionType:[0,0],waConnectStatus:[0,0],capabilities2:[0,0]},ig_contact_info:{e2eeEligibility:[0,0]},reactions:{timestampMs:[0,0],authorityLevel:[0,0]},threads:{lastActivityTimestampMs:[0,0],lastReadWatermarkTimestampMs:[0,0],removeWatermarkTimestampMs:[0,0],muteExpireTimeMs:[0,0],isAdminSnippet:!1,ongoingCallState:[0,0],snippetHasEmoji:!1,hasPersistentMenu:!1,disableComposerInput:!1,capabilities:[0,0],isCustomThreadPicture:!1,isDisappearingMode:!1,unreadDisappearingMessageCount:[0,0],authorityLevel:[0,0],capabilities2:[0,0],muteCallsExpireTimeMs:[0,0],unsendLimitMs:[0,0],threadInvitesEnabled:[0,0],threadInvitesEnabledV2:[0,0],capabilities3:[0,0]},threads_ranges_v2__generated:{minThreadKey:[0,0],minLastActivityTimestampMs:[0,0],maxThreadKey:[0,0],maxLastActivityTimestampMs:[0,0],isLoadingBefore:!1,isLoadingAfter:!1,hasMoreBefore:!1,hasMoreAfter:!1},messages:{timestampMs:[0,0],primarySortKey:[0,0],secondarySortKey:[0,0],isAdminMessage:!1,sendStatus:[0,0],sendStatusV2:[0,0],isUnsent:!1,replyStatus:[0,0],replyAttachmentType:[0,0],hasQuickReplies:!1,textHasLinks:!1,viewFlags:[0,0],displayedContentTypes:[0,1],quickReplyType:[0,0],authorityLevel:[0,0],unsentTimestampMs:[0,0]},messages_ranges_v2__generated:{isLoadingBefore:!1,isLoadingAfter:!1,hasMoreBefore:!1,hasMoreAfter:!1},participants:{readWatermarkTimestampMs:[0,0],deliveredWatermarkTimestampMs:[0,0],authorityLevel:[0,0],readActionTimestampMs:[0,0],groupParticipantJoinState:[0,0]},attachments:{timestampMs:[0,0],attachmentType:[0,0],hasMedia:!1,isSharable:!1,hasXma:!1,attachmentIndex:[0,0],authorityLevel:[0,0]},attachments_ranges_v2__generated:{mediaGroup:[0,0],isLoadingBefore:!1,isLoadingAfter:!1,hasMoreBefore:!1,hasMoreAfter:!1},attachment_items:{attachmentIndex:[0,0]},group_membership_approval_requests:{authorityLevel:[0,0]},admin_message_ctas:{timestampMs:[0,0],showAdChoiceIcon:!1},thread_nullstate:{ctaType:[0,0],privacyTextCtaType:[0,0]},messages_status:{timestampMs:[0,0]},polls:{pollType:[0,0]},poll_options_v2:{voteCount:[0,0],sortKeyVotingTimestamp:[0,0],sortKeyCreationTimestamp:[0,0]},filtered_threads_ranges_v2__generated:{minThreadKey:[0,0],minLastActivityTimestampMs:[0,0],maxThreadKey:[0,0],maxLastActivityTimestampMs:[0,0],isLoadingBefore:!1,isLoadingAfter:!1,hasMoreBefore:!1,hasMoreAfter:!1,folderName:"inbox",secondaryThreadRangeFilter:[0,0],threadRangeFilterValue:""},community_folders:{capabilities:[0,0],notificationMutedUntil:[0,0],inviteStatus:[0,0]},community_members:{source:[0,0],adminActions:[0,0]},inbox_threads_ranges:{minThreadKey:[0,0],minLastActivityTimestampMs:[0,0],isLoadingBefore:!1,hasMoreBefore:!1},community_direct_invites_presets:{fallbackUrl:"",pictureUrlExpirationTimestampMs1:[0,0],pictureUrlExpirationTimestampMs2:[0,0],presetTypeV2:"ALL_MEMBERS"},sync_group_threads_ranges:{minThreadKey:[0,0],minLastActivityTimestampMs:[0,0],isLoadingBefore:!1,hasMoreBefore:!1},community_chat_polls:{pollType:[0,0]},community_chat_poll_options:{voteCount:[0,0],sortKeyVotingTimestamp:[0,0],sortKeyCreationTimestamp:[0,0]},reactions_v2:{viewerReactionTimestampMs:[0,0]},group_invitations_pending:{communityJoinRequestStatus:[0,0],communityParticipationControlRequestStatus:[0,0],communityParticipationControlSetting:[0,0]},universal_search_recent_searches:{lastAccessedTimestampMs:[0,0]},contact_upload_settings:{authorityLevel:[0,0]},presence_settings:{isActiveStatusViewable:!1,isActiveStatusViewableOnFb:!1,isActiveStatusViewableOnMessenger:!1,hasConvertedToViewSideSettings:!1},video_chat_links_joining:{canAnonymousUsersJoin:[0,0]},notification_settings:{includeInSwitchAccountBadges:!1,mutePageAccountMessageReminder:!1},avatar_settings:{enableAvatarHotlike:!1},rtc_call_events:{isProcessed:!1},transaction_history:{timestampMs:[0,0]},thread_themes:{isDeprecated:!1},ranking_scores:{score:[0,0],scoreIndex:[0,0]},story_buckets:{pageNum:[0,0],readState:[0,0]},stories:{authorityLevel:[0,0]},story_viewers:{interactionType:[0,1],authorityLevel:[0,0]},story_reactions:{authorityLevel:[0,0]},story_ad_unit:{shouldShowAdChoice:!1},story_overlays:{authorityLevel:[0,0]},rooms:{notificationMutedUntilMs:[0,0]},media_staging:{progress:[0,0]},data_trace_meta:{initTimestampMs:[0,0],foregroundTimestampMs:[0,0],traceType:[0,0],shouldFlush:!1},data_trace_addon:{timestampMs:[0,0]},secure_encrypted_backups_client_state:{authorityLevel:[0,0],encryptionVersion:[0,0],revisionVersion:[0,0]},secure_encrypted_backups_epochs:{authorityLevel:[0,0]},encrypted_backups:{authorityLevel:[0,0]},secure_encrypted_backups_generated_recovery_code:{virtualDeviceType:[0,1]},encrypted_backups_virtual_devices:{virtualDeviceType:[0,1],removalStatus:[0,1]},encrypted_backups_metadata:{authorityLevel:[0,0]},cutover_threads:{isMigrated:!1,showOpenMessageHistory:!1}}}),null);
__d("LSStorage",["unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d,e){a=a.tableNames[b];b=a.indexes;a=a.primaryKeyIds;a=e==null?a:b[e];return a.reduceRight(function(a,b){if(d[b]!==void 0||e!=null)return{hd:d[b],tl:a};throw c("unrecoverableViolation")("primary key must be defined on object","messenger_web_product")},0)}function b(a,b){while(a!==0&&b!==0){if(a.hd!==b.hd&&!(Array.isArray(a.hd)&&Array.isArray(b.hd)&&a.hd.length===b.hd.length&&a.hd.every(function(a,c){return a===b.hd[c]})))return!1;a=a.tl;b=b.tl}return a===0&&b===0}g.searchKey=a;g.areKeysEqual=b}),98);
__d("TempLogForMessages",[],(function(a,b,c,d,e,f){"use strict";d=function(){function a(a){this.$1=0,this.$3=a,this.$2=new Array(a)}var b=a.prototype;b.push=function(a){this.$2[this.$1%this.$3]=a,this.$1+=1};b.toArray=function(){var a=[];for(var b=this.$1;b<this.$3+this.$1;b++){var c=this.$2[b%this.$3];c!=null&&a.push(c)}return a};return a}();var g=new d(1e3);function a(a,b){g.push(b+a.toString())}function b(){g.push("eot")}function c(){return JSON.stringify(g.toArray())}f.recordStorageIdSet=a;f.recordEndOfTxn=b;f.getInsertionLog=c}),66);
__d("ReStorePersistence",["FBLogger","PromiseOrValue","TempLogForMessages","gkx","isPromise","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h={SENTINEL_DELETED:1};function i(m,n,o){return(m.has(n)?m:m.set(n,o())).get(n)}function j(m){if(m==null)return m;var n=Object.getOwnPropertyNames(m),j={},o,p;for(o=0;o<n.length;o++)p=m[n[o]],j[n[o]]=Array.isArray(p)?[].concat(p):p;return j}function k(m,n){n===void 0&&(n=h);if(c("gkx")("6767")){if(m===n)return!0;return m!=null&&typeof m==="object"&&Object.prototype.hasOwnProperty.call(m,"SENTINEL_DELETED")?!0:!1}return m===n}function l(m){return{clearCache:m.clearCache,close:m.close,createTransaction:function(n,o){o===void 0&&(o=new Map());var p=!1;function q(){if(p)throw c("FBLogger")("messenger_web_product").mustfixThrow("Transaction has closed")}return{close:function(){p=!0},flush:async function(){await m.flush(o),p=!0},table:function(r){function s(w,x){q();var y=u.get(x);if(k(y))return void 0;return y!==void 0?y:m.get(w,r,x,n)}function t(w,x){return d("PromiseOrValue").map(s(w,x),function(y){if(y===void 0){var z=u.get(x),A=c("gkx")("1706")?"true":"false";throw c("FBLogger")("messenger_web_product").addMetadata("LS_WEB","RAW_DATA",c("justknobx")._("86")?d("TempLogForMessages").getInsertionLog():"").mustfixThrow("Got unexpected undefined, pdb: "+A+", mode: "+n+", table: "+r+", id: "+(JSON.stringify(x)||"")+", deletedInThisTxn: "+(k(z)?"true":"false"))}return y})}var u=i(o,r,function(){return new Map()});function v(w,x){return{read:function*(y){var z=s(w,y);return c("isPromise")(z)?yield z:z},readExn:function*(y){var z=t(w,y);return c("isPromise")(z)?yield z:z},readHeader:function*(){var y=s(w,x);return c("isPromise")(y)?yield y:y},remove:function*(y){q(),u.set(y,h)},removeHeader:function*(){q(),u.set(x,h)},write:function*(y,z){q(),u.set(y,z)},writeHeader:function*(y){q(),u.set(x,y)},writeNew:function*(y){var z=d("PromiseOrValue").map(s(w,"nextId"),function(z){z===void 0&&(z=0);u.set("nextId",z+1);u.set(z,y);return z});return c("isPromise")(z)?yield z:z}}}return{getBPlusTreeStore:v,incrementSeed:function(w,x){return d("PromiseOrValue").map(s(w,"seed"),function(y){y===void 0&&(y=0);u.set("seed",Math.max(y,x||0)+1);return x===void 0?y:x})},readData:function*(w,x){var y=s(w,x);return c("isPromise")(y)?yield y:y},readDataExn:function*(w,x){var y=t(w,x);return c("isPromise")(y)?yield y:y},readSeed:function(w){return d("PromiseOrValue").map(s(w,"seed"),function(x){x===void 0&&(x=0);return x})},remove:function(w,x){q(),u.set(x,h)},writeData:function(w,x,y){q(),u.set(x,j(y))},writeNewData:function(w,x){return d("PromiseOrValue").map(s(w,"nextId"),function(y){y===void 0&&(y=0);u.set("nextId",y+1);u.set(y,j(x));return y})}}}}},releaseLockIfNeeded:m.releaseLockIfNeeded,waitForLock:m.waitForLock}}g.sentinelDeleted=h;g.isDeletedValue=k;g.createDbStore=l}),98);
__d("ReStoreTransactionLock",["isPromise"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function h(k){var l=this;this.waitFor=null;k!=null&&(this.waitFor=k.then(function(m){return l.waitFor=null}))}var j=h.prototype;j.chainPromiseOrValue=function(k){if(this.waitFor!=null)return this.waitFor.then(function(){return k("\ud83d\udd12")});else return k("\ud83d\udd12")};return h}(),i=function(){function i(){this.lock=null}var j=i.prototype;j.chainPromiseOrValue=function(k){var l=this,m=this.lock;if(m==null){var n=k("\ud83d\udd12");if(c("isPromise")(n))m=n;else return n}else m=m.then(function(){return k("\ud83d\udd12")});var o=m.then(function(p){l.lock===o&&(l.lock=null);return p}).finally(function(p){l.lock===o&&(l.lock=null)});this.lock=o;return o};return i}();g.WaitForPromiseLock=h;g.ReStoreTransactionLock=i}),98);
__d("ReStoreUtils",["LSTableDefaults"],(function(a,b,c,d,e,f,g){"use strict";async function h(j){var k=[],l=await j.next();while(!l.done)k.push(l.value),l=await j.next();return k}function i(j,k){var l=c("LSTableDefaults")[k];return!l?j:Object.keys(l).reduce(function(m,n){Object.prototype.hasOwnProperty.call(m,n)||(m[n]=l[n]);return m},babelHelpers.extends({},j))}g.collectIterator=h;g.appendDefaultValues=i}),98);
__d("ReStore",["BPlusTreeBase","ExecutionEnvironment","FBLogger","I64","LSDbKeyComparer","LSStorage","PromiseOrValue","ReStorePersistence","ReStoreTransactionLock","ReStoreUtils","ReStoreVaulting","clearTimeout","cr:2917","cr:2921","cr:2922","emptyFunction","err","gkx","isPromise","setTimeout","unrecoverableViolation"],(function(aa,a,b,c,ba,ca,da){"use strict";var ea=new Set(["threads","messages","pending_tasks","network_requests"]),d=function(h){babelHelpers.inheritsLoose(d,h);function d(){return h.call(this,"Transaction has finished")||this}return d}(babelHelpers.wrapNativeSuper(Error));function fa(h){var i=c("I64").cast(h);if(i===void 0)throw b("unrecoverableViolation")("Expected int64","messenger_web_product");return c("I64").to_float(i)}function e(h,i){function j(k){if(k.done)return k.value;if(!b("isPromise")(k.value))throw b("unrecoverableViolation")("expected promise","messenger_web_product");return k.value.then(function(l){return j(h.next(l))})}return j(h.next(i))}function f(h,i){return{next:function(j){return i.chainPromiseOrValue(function(k){return h.next(k,j)})}}}function g(h,i,j){return b("BPlusTreeBase")(c("LSDbKeyComparer").compareKey,16,i.getBPlusTreeStore(h,j==null?"root":"index("+j+")"))}function ga(h,i,j){return(h.has(i)?h:h.set(i,j())).get(i)}function ha(h,i,j){var k=c("ReStorePersistence").createDbStore(h),l=j||(a("cr:2922")!=null?a("cr:2922")(i,h.shouldSync):null);l==null&&b("FBLogger")("messenger_web_product").warn("ReStore created without subscription manager");var m=a("LSStorage").searchKey.bind(null,i),n={background:{first:null,last:null},ui:{first:null,last:null}},o=ra(async function(){var z=new Map(),A=k.createTransaction("readwrite"),B=qa(A,z);try{a("cr:2917")!=null&&await a("cr:2917").runMigrationForTableDefaultValuesIfNeeded(B,i),a("cr:2921")!=null&&await a("cr:2921").runMigrationForIndicesIfNeeded(B,i,function(C,D){return new(c("ReStoreTransactionLock").ReStoreTransactionLock)().chainPromiseOrValue(function(E){return pa(z,A,new WeakMap(),C,D,E)})}),await A.flush()}catch(C){A.close();throw C}},"background"),p=new(c("ReStoreTransactionLock").WaitForPromiseLock)(o),ia=new Map();function q(z,A,B){return!A||z<=0?B:{hd:A.hd,tl:z===1?0:q(z-1,A.tl,B)}}function r(z,A){if(z==null)return void 0;var B=babelHelpers.extends({},z);B.gt!=null&&(B.gt=q(A,B.gt,{hd:c("LSDbKeyComparer").MAX_KEY,tl:0}));B.lte!=null&&(B.lte=q(A,B.lte,{hd:c("LSDbKeyComparer").MAX_KEY,tl:0}));return B}function s(z,A,B,C,D){var E=JSON.stringify([A,B]),F=z.get(E);z.set(E,[F==null?C:F[0],D])}async function t(z,A,B,C,D,E){var F=z.table(B),G=g(A,F,C),H=await e(G.getWithDefault(D,void 0));if(H===void 0)return void 0;var I=e(F.readDataExn(A,H)),J=c("ReStoreVaulting").maybeVaultDbRow(I,B);return J}async function ja(z,A,B,C,D,E){var F=await t(z,A,B,C,D,E);return F===void 0?void 0:m(B,F)}function u(z,A,B,C,D,E){function F(){var G,H=0,I=z.table(B),J=g(A,I,C),u=J.entries(babelHelpers.extends({},r(E,(C===void 0?i.tableNames[B].primaryKeyIds:i.tableNames[B].indexes[C]).length),{dir:D}));return G={next:function(K,L){b("gkx")("3827")&&(H++,H===20&&!ea.has(B)&&b("FBLogger")("messenger_web_product").catching(b("err")("ReStore overfetch")).warn('ReStore fetched 20 or more rows from "%s" table',B));return c("PromiseOrValue").map(e(u.next(L)),function(M){return M.done?{done:!0}:c("PromiseOrValue").map(e(I.readDataExn(A,M.value[1])),function(N){var O=c("ReStoreVaulting").maybeVaultDbRow(N,B);return{done:!1,value:[M.value[0],O]}})})}},G[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]=F,G}return F()}async function v(z,A,B,C,D,E,F){function G(Q,R){var S=[],T=Q;while(T!==0)S.push(T.hd),T=T.tl;return S.length>=R?Q:S.reduceRight(function(U,V){return{hd:V,tl:U}},{hd:c("LSDbKeyComparer").MAX_KEY,tl:0})}if(E!=null&&c("LSDbKeyComparer").compareKey(D,E)===0)return;var H=i.tableNames[C],I=H.cascadeUpdates,J=H.primaryKeyIds,K=async function(){if(M){if(N>=L.length)return"break";O=L[N++]}else{N=L.next();if(N.done)return"break";O=N.value}var Q=O,R=Q.indexName,C=Q.tableName,S=i.tableNames[C],T=S.indexes,U=S.primaryKeyIds,V=R==null?U:T[R],W={gte:D,lte:G(D,V.length)},X=u(A,B,C,R,"asc",W),Y=[],Z=await X.next(F);while(!Z.done)Y.push(Z.value),Z=await X.next(F);for(var ua=0;ua<Y.length;ua++){var va=Y[ua];va[0];var wa=va[1],$=m(C,wa);if(E===void 0)await x(z,A,B,C,$,F),await v(z,A,B,C,$,void 0,F);else{var xa=J.reduce(function(ya,za,Aa){var Ba=ya[0],E=ya[1];if(!E)return[Ba,E];Ba[V[Aa]]=E.hd;return[Ba,E.tl]},[babelHelpers.extends({},wa),E])[0];await la(z,A,B,C,$,xa,F);await v(z,A,B,C,$,m(C,xa),F)}}};for(var L=I,M=Array.isArray(L),N=0,L=M?L:L[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var O,P=await K();if(P==="break")break}}async function ka(z,A,B,C){var D=i.tableNames[B].autoIncrement;if(!D)throw b("unrecoverableViolation")("only supported for auto-incrementing tables","messenger_web_product");var E=await z.table(B).readSeed(A);if(E===void 0)throw b("unrecoverableViolation")("unexpected undefined autoIncrementSeed","messenger_web_product");return c("I64").of_float(E)}async function w(z,A,B,C,D,E){var F=A.table(C),G=g(B,F),H=i.tableNames[C],I=m(C,D),J={},K=await e(G.getWithDefault(I,void 0)),L,M=D;if(K!==void 0){L=await e(F.readDataExn(B,K));J=y(Object.keys(H.indexes),C,L);var N=c("ReStoreVaulting").maybeUnvaultDbRow(D,C);F.writeData(B,K,N)}else{if(H.autoIncrement)throw b("unrecoverableViolation")("Id must not be specified for new record when table has an autoincrementing primary key","messenger_web_product");M=c("ReStoreUtils").appendDefaultValues(D,H.name);var O=c("ReStoreVaulting").maybeUnvaultDbRow(M,C);K=await F.writeNewData(B,O);await e(G.set(I,K))}var P=y(Object.keys(H.indexes),C,M),Q=Object.keys(P);for(var R=0;R<Q.length;R++){var S=Q[R];J[S]!==void 0&&c("LSDbKeyComparer").compareKey(J[S],P[S])===0&&(delete P[S],delete J[S])}await ma(z,A,B,C,P,E);await na(A,B,C,K,P);var T=Object.keys(J);for(var U=0;U<T.length;U++){var V=T[U],W=g(B,F,V);await e(W.delete(J[V]))}s(z,C,I,L,M)}async function la(z,A,B,C,D,E,F){var G=m(C,E);c("LSStorage").areKeysEqual(D,G)||await x(z,A,B,C,D,F);await w(z,A,B,C,E,F)}async function x(z,A,B,C,D,E){var F=A.table(C),G=g(B,F),H=i.tableNames[C],I=await e(G.getWithDefault(D,void 0)),J;if(I!==void 0){J=await e(F.readDataExn(B,I));if(Object.keys(H.indexes).length){var K=Object.keys(H.indexes);for(var L=0;L<K.length;L++){var M=K[L],N=m(C,J,M);if(N!=null){var O=g(B,F,M);await e(O.delete(N))}}}await e(G.delete(D));F.remove(B,I);s(z,C,D,J,void 0)}}function y(z,A,B){return z.reduce(function(C,D){var E=m(A,B,D);C[D]=E;return C},{})}async function ma(z,A,B,C,D,E){var F=A.table(C),G=new Set(),H=Object.keys(D);for(var I=0;I<H.length;I++){var J=H[I],K=g(B,F,J),L=D[J],M=await e(K.getWithDefault(L));if(M!=null&&!G.has(M)){var N=m(C,await e(F.readDataExn(B,M)));await x(z,A,B,C,N,E);await v(z,A,B,C,N,void 0,E);G.add(M)}}}async function na(z,A,B,C,D){var E=z.table(B),F=Object.keys(D);for(var G=0;G<F.length;G++){var H=F[G],I=g(A,E,H),J=D[H];await e(I.set(J,C))}}async function oa(z,A,B,C,D,E){var F=A.table(C),G=g(B,F),H=i.tableNames[C];if(H.autoIncrement){var I=D[i.tableNames[C].primaryKeyIds[0]],J=c("I64").of_float(await F.incrementSeed(B,I===void 0?I:fa(I)));D[i.tableNames[C].primaryKeyIds[0]]=J}var K=c("ReStoreUtils").appendDefaultValues(D,H.name),L=m(C,K);if(L==null)throw new Error("Evaluating the object store's key path did not yield a value");if(!await e(G.has(L))){var M=y(Object.keys(H.indexes),C,K);await ma(z,A,B,C,M,E);var N=c("ReStoreVaulting").maybeUnvaultDbRow(K,C),O=await F.writeNewData(B,N);await e(G.set(L,O));await na(A,B,C,O,M);s(z,C,L,void 0,K)}}async function pa(z,A,B,C,D,E){var F=A.table(C),G=D.map(function(X){return g(B,F,X)});for(var H=G,I=Array.isArray(H),J=0,H=I?H:H[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var K;if(I){if(J>=H.length)break;K=H[J++]}else{J=H.next();if(J.done)break;K=J.value}var L=K;await e(L.clear())}var M=D.filter(function(X){var Y;return((Y=i.tableNames[C])==null?void 0:Y.indexes[X])!=null});if(M.length===0)return;var N=g(B,F),O=u(A,B,C,void 0,"asc",void 0),P=[],Q=await O.next(E);while(!Q.done)P.push(Q.value),Q=await O.next(E);for(var R=0;R<P.length;R++){var S=P[R],T=S[0],U=S[1],V=y(M,C,U);await ma(z,A,B,C,V,E);var W=await e(N.get(T));await na(A,B,C,W,V)}}function qa(z,A){var B=new(c("ReStoreTransactionLock").ReStoreTransactionLock)(),C=new WeakMap();return{table:function(D){return{add:function(E){return B.chainPromiseOrValue(async function(F){var G;try{b("gkx")("3827")&&(G=b("setTimeout")(function(){b("FBLogger")("messenger_web_product").mustfix("ReStore add took longer than 10 seconds to execute")},1e4)),await oa(A,z,C,D,E,F)}finally{G!=null&&b("clearTimeout")(G)}})},delete:function(E){return B.chainPromiseOrValue(async function(F){await x(A,z,C,D,E,F),await v(A,z,C,D,E,void 0,F)})},deleteThenInsert:function(E){return B.chainPromiseOrValue(async function(F){var G=c("ReStoreUtils").appendDefaultValues(E,D);await w(A,z,C,D,G,F);await v(A,z,C,D,m(D,G),void 0,F)})},entries:function(E,F,G){F===void 0&&(F="asc");return f(u(z,C,D,void 0,F,G),B)},get:function(E){return B.chainPromiseOrValue(function(F){return t(z,C,D,void 0,E,F)})},index:function(E){return{entries:function(F,G,H){G===void 0&&(G="asc");return f(u(z,C,D,E,G,H),B)},get:function(F){return B.chainPromiseOrValue(function(G){return t(z,C,D,E,F,G)})},getKey:function(F){return B.chainPromiseOrValue(function(G){return ja(z,C,D,E,F,G)})},keyLength:i.tableNames[D].indexes[E].length}},keyLength:i.tableNames[D].primaryKeyIds.length,peekNextAutoIncrementId:function(){return B.chainPromiseOrValue(function(E){return ka(z,C,D,E)})},put:function(E){return B.chainPromiseOrValue(function(F){return w(A,z,C,D,E,F)})},upsert:function(E,F){return B.chainPromiseOrValue(async function(G){await la(A,z,C,D,E,F,G),await v(A,z,C,D,E,m(D,F),G)})}}}}}async function ra(z,A){n[A].last==null?n[A].first=n[A].last={value:z}:n[A].last=n[A].last.next={value:z};try{await k.waitForLock();var B=n.ui.first==null?n.background:n.ui;if(B.first==null){b("FBLogger")("messenger_web_product").mustfix("Expected work is missing");return}var C=B.first;B.first===B.last&&(B.last=null);B.first=B.first.next;await C.value()}finally{await k.releaseLockIfNeeded()}}function sa(z,A){z.clear(),A.forEach(function(B,C){return z.set(C,B)})}function ta(z,A,B){B===void 0&&(B="background");var C;b("gkx")("3827")&&(C=b("err")(""));return new Promise(function(D,E){o=o.then(function(){return ra(async function(){var F;try{b("gkx")("3827")&&b("ExecutionEnvironment").canUseDOM&&(F=b("setTimeout")(function(){b("FBLogger")("messenger_web_product").catching(C).mustfix("ReStore transaction took longer than 10 seconds to execute")},1e4));var G=new Map(),H=new Map(),I=function(){return{changedKeys:G,changeSet:H}},J=function(Z){sa(G,Z.changedKeys),sa(H,Z.changeSet)},K=k.createTransaction("readwrite",H),L;try{var M=qa(K,G);L=await z(M,I,J);await K.flush()}catch(Z){K.close();throw Z}F!=null&&b("clearTimeout")(F);var N=new WeakMap();for(var O=G,P=Array.isArray(O),Q=0,O=P?O:O[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var R;if(P){if(Q>=O.length)break;R=O[Q++]}else{Q=O.next();if(Q.done)break;R=Q.value}var S=R,T=S[0],U=S[1],V=U[0],W=U[1],X=JSON.parse(T),Y=X[0];X[1];await (l==null?void 0:l.notifyTableAndIndexSubscribers(Y,V,W,N,!0))}D(L)}catch(Z){b("gkx")("3827")&&F!=null&&b("clearTimeout")(F),E(Z)}l==null?void 0:l.notifyCommit(!0)},B)})})}return{clearCacheIfSupported:function(){var z=k;z instanceof Object&&z.clearCache!==void 0&&z.clearCache instanceof Function&&z.clearCache()},closeDb:function(){var z=k;z instanceof Object&&z.close!==void 0&&z.close()},getTableData:function(){return i},runInTransaction:ta,subscribeToCommit:function(z){return(l==null?void 0:l.subscribeToCommit(z))||b("emptyFunction")},subscriptionManager:l,table:function(z){return ga(ia,z,function(){var A=new Map();return{entries:function(B,C,D){C===void 0&&(C="asc");return f(u(k.createTransaction("readonly"),B,z,void 0,C,D),p)},get:function(B,C){C===void 0&&(C=new WeakMap());return p.chainPromiseOrValue(function(D){return t(k.createTransaction("readonly"),C,z,void 0,B,D)})},index:function(B){return ga(A,B,function(){return{entries:function(C,D,E){D===void 0&&(D="asc");return f(u(k.createTransaction("readonly"),C,z,B,D,E),p)},get:function(C,D){D===void 0&&(D=new WeakMap());return p.chainPromiseOrValue(function(E){return t(k.createTransaction("readonly"),D,z,B,C,E)})},getKey:function(C){return p.chainPromiseOrValue(function(D){return ja(k.createTransaction("readonly"),new WeakMap(),z,B,C,D)})},keyLength:i.tableNames[z].indexes[B].length,subscribe:function(C,D){return(l==null?void 0:l.subscribeIndex(z,B,C,r(D,i.tableNames[z].indexes[B])))||b("emptyFunction")}}})},keyLength:i.tableNames[z].primaryKeyIds.length,peekNextAutoIncrementId:function(){return p.chainPromiseOrValue(function(B){return ka(k.createTransaction("readonly"),new WeakMap(),z,B)})},subscribe:function(B,C){return(l==null?void 0:l.subscribeTable(z,B,r(C,i.tableNames[z].primaryKeyIds.length)))||b("emptyFunction")}}})}}}ha.TransactionClosedError=d;da.default=ha}),98);
__d("ReStoreDefaultValueMigration",["LSTableDefaults","QPLUserFlow","ReStoreDefaultValuesMetadata","ReStoreUtils","nativePromiseRegeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return c("nativePromiseRegeneratorRuntime").async(function(w){while(1)switch(w.prev=w.next){case 0:e={};w.next=3;return c("nativePromiseRegeneratorRuntime").awrap(d("ReStoreUtils").collectIterator(b.table(d("ReStoreDefaultValuesMetadata").defaultValuesTableName).entries(a)));case 3:f=w.sent,(g=f,h=Array.isArray(g),i=0,g=h?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 5:if(!h){w.next=11;break}if(!(i>=g.length)){w.next=8;break}return w.abrupt("break",41);case 8:j=g[i++];w.next=15;break;case 11:i=g.next();if(!i.done){w.next=14;break}return w.abrupt("break",41);case 14:j=i.value;case 15:k=j;l=k[0];m=k[1];if(!(l!=null)){w.next=39;break}o=d("ReStoreDefaultValuesMetadata").tryParseDefaultValuesData(m);if(!(o==null)){w.next=22;break}return w.abrupt("continue",39);case 22:(p=o.columns,q=o.tableName),e[q]=(n=e[q])!=null?n:new Set(),(r=p,s=Array.isArray(r),t=0,r=s?r:r[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 25:if(!s){w.next=31;break}if(!(t>=r.length)){w.next=28;break}return w.abrupt("break",39);case 28:u=r[t++];w.next=35;break;case 31:t=r.next();if(!t.done){w.next=34;break}return w.abrupt("break",39);case 34:u=t.value;case 35:v=u,e[q].add(v);case 37:w.next=25;break;case 39:w.next=5;break;case 41:return w.abrupt("return",e);case 42:case"end":return w.stop()}},null,this)}function i(a,b,d){var e,f,g,i,j,k,l,m;return c("nativePromiseRegeneratorRuntime").async(function(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return c("nativePromiseRegeneratorRuntime").awrap(h(a,b));case 2:e=n.sent;f={};for(g in d.tableNames){i=c("LSTableDefaults")[g];if(i!=null)for(j in i)l=(k=e[g])==null?void 0:k.has(j),l||(f[g]=(m=f[g])!=null?m:{},f[g][j]=i[j])}return n.abrupt("return",f);case 6:case"end":return n.stop()}},null,this)}function j(a,b){var e,f,g;return c("nativePromiseRegeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.t0=c("nativePromiseRegeneratorRuntime").keys(b);case 1:if((h.t1=h.t0()).done){h.next=9;break}e=h.t1.value;f=Object.keys(c("LSTableDefaults")[e]||{});g={columns:f,tableName:e};h.next=7;return c("nativePromiseRegeneratorRuntime").awrap(a.table(d("ReStoreDefaultValuesMetadata").defaultValuesTableName).put(d("ReStoreDefaultValuesMetadata").defaultValuesColumnToValue(g)));case 7:h.next=1;break;case 9:case"end":return h.stop()}},null,this)}function a(a,b){var e,f,g,h,k,l,m,n;return c("nativePromiseRegeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:e=new WeakMap();f=function(a,b){c("QPLUserFlow").addPoint(c("qpl")._(25305590,"1127"),"default_values_update_end_failure"),c("QPLUserFlow").addAnnotations(c("qpl")._(25305590,"1127"),{string:{default_values_update_failure_point:b,default_values_update_failure_reason:String(a)}})};o.prev=2;o.next=5;return c("nativePromiseRegeneratorRuntime").awrap(i(e,a,b));case 5:g=o.sent,o.prev=6,o.t0=c("nativePromiseRegeneratorRuntime").keys(g);case 8:if((o.t1=o.t0()).done){o.next=26;break}h=o.t1.value;k=a.table(h).entries(e);o.next=13;return c("nativePromiseRegeneratorRuntime").awrap(k.next());case 13:l=o.sent;case 14:if(l.done){o.next=24;break}m=babelHelpers["extends"]({},l.value[1]);n=d("ReStoreUtils").appendDefaultValues(m,h);o.next=19;return c("nativePromiseRegeneratorRuntime").awrap(a.table(h).put(n));case 19:o.next=21;return c("nativePromiseRegeneratorRuntime").awrap(k.next());case 21:l=o.sent;o.next=14;break;case 24:o.next=8;break;case 26:o.next=28;return c("nativePromiseRegeneratorRuntime").awrap(j(a,g));case 28:c("QPLUserFlow").addPoint(c("qpl")._(25305590,"1127"),"default_values_update_end_success");o.next=34;break;case 31:o.prev=31,o.t2=o["catch"](6),f(o.t2,"setDefaultValues");case 34:o.next=39;break;case 36:o.prev=36,o.t3=o["catch"](2),f(o.t3,"findDefaultValuesToUpdate");case 39:case"end":return o.stop()}},null,this,[[2,36],[6,31]])}g.runMigrationForTableDefaultValuesIfNeeded=a}),98);
__d("ReStoreIndicesMigration",["QPLUserFlow","ReStoreIndexMetadata","ReStoreUtils","nativePromiseRegeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var e,f,g,h,i,j,k,l,m,n,o,p,q;return c("nativePromiseRegeneratorRuntime").async(function(r){while(1)switch(r.prev=r.next){case 0:e={};r.next=3;return c("nativePromiseRegeneratorRuntime").awrap(d("ReStoreUtils").collectIterator(b.table(d("ReStoreIndexMetadata").indicesTableName).entries(a)));case 3:f=r.sent,(g=f,h=Array.isArray(g),i=0,g=h?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]());case 5:if(!h){r.next=11;break}if(!(i>=g.length)){r.next=8;break}return r.abrupt("break",27);case 8:j=g[i++];r.next=15;break;case 11:i=g.next();if(!i.done){r.next=14;break}return r.abrupt("break",27);case 14:j=i.value;case 15:k=j;l=k[0];m=k[1];if(!(l!=null)){r.next=25;break}o=d("ReStoreIndexMetadata").tryParseIndexData(m);if(!(o==null)){r.next=22;break}return r.abrupt("continue",25);case 22:(p=o.indexName,q=o.tableName),e[q]=(n=e[q])!=null?n:{},e[q][p]={index:o.data,key:l};case 25:r.next=5;break;case 27:return r.abrupt("return",e);case 28:case"end":return r.stop()}},null,this)}function i(a,b,e){var f,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;return c("nativePromiseRegeneratorRuntime").async(function(y){while(1)switch(y.prev=y.next){case 0:y.next=2;return c("nativePromiseRegeneratorRuntime").awrap(h(a,b));case 2:f=y.sent;g={};for(i in e.tableNames){j=e.tableNames[i];for(k in j.indexes)m=j.indexes[k],n=(l=f[i])==null?void 0:l[k],d("ReStoreIndexMetadata").indicesDiffer(n==null?void 0:n.index,m)&&(g[i]=(o=g[i])!=null?o:{},g[i][k]=m)}p={};for(q in f){r=f[q];for(s in r)v=r[s],w=(t=e.tableNames[q])==null?void 0:(u=t.indexes)==null?void 0:u[s],w==null&&(p[q]=(x=p[q])!=null?x:{},p[q][s]=v)}return y.abrupt("return",{toRemove:p,toUpdate:g});case 8:case"end":return y.stop()}},null,this)}function j(a,b){var e,f,g,h,i;return c("nativePromiseRegeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:j.t0=c("nativePromiseRegeneratorRuntime").keys(b);case 1:if((j.t1=j.t0()).done){j.next=15;break}e=j.t1.value;f=b[e];j.t2=c("nativePromiseRegeneratorRuntime").keys(f);case 5:if((j.t3=j.t2()).done){j.next=13;break}g=j.t3.value;h=f[g];i={data:h,indexName:g,tableName:e};j.next=11;return c("nativePromiseRegeneratorRuntime").awrap(a.table(d("ReStoreIndexMetadata").indicesTableName).put(d("ReStoreIndexMetadata").indexDataToValue(i)));case 11:j.next=5;break;case 13:j.next=1;break;case 15:case"end":return j.stop()}},null,this)}function k(a,b){var e,f,g,h;return c("nativePromiseRegeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.t0=c("nativePromiseRegeneratorRuntime").keys(b);case 1:if((i.t1=i.t0()).done){i.next=14;break}e=i.t1.value;f=b[e];i.t2=c("nativePromiseRegeneratorRuntime").keys(f);case 5:if((i.t3=i.t2()).done){i.next=12;break}g=i.t3.value;h=f[g].key;i.next=10;return c("nativePromiseRegeneratorRuntime").awrap(a.table(d("ReStoreIndexMetadata").indicesTableName)["delete"](h));case 10:i.next=5;break;case 12:i.next=1;break;case 14:case"end":return i.stop()}},null,this)}function a(a,b,d){var e=new WeakMap();c("QPLUserFlow").addPoint(c("qpl")._(25305590,"1127"),"index_migration_started");var f=function(a,b){c("QPLUserFlow").addPoint(c("qpl")._(25305590,"1127"),"index_migration_end_failure"),c("QPLUserFlow").addAnnotations(c("qpl")._(25305590,"1127"),{string:{index_migration_failure_point:b,index_migration_failure_reason:String(a)}})};return i(e,a,b).then(function(e){var f,g,h,i,l,m,n,o;return c("nativePromiseRegeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:(f=e.toRemove,g=e.toUpdate),h=Array.from(new Set([].concat(Object.keys(g),Object.keys(f)))),c("QPLUserFlow").addAnnotations(c("qpl")._(25305590,"1127"),{"int":{index_migration_rebuild_tables_count:h.length},string_array:{index_migration_rebuilt_tables:h}}),i=0;case 4:if(!(i<h.length)){p.next=13;break}l=h[i];if(!(b.tableNames[l]!=null)){p.next=10;break}o=Array.from(new Set([].concat(Object.keys((m=g[l])!=null?m:{}),Object.keys((n=f[l])!=null?n:{}))));p.next=10;return c("nativePromiseRegeneratorRuntime").awrap(d(l,o));case 10:i++;p.next=4;break;case 13:p.next=15;return c("nativePromiseRegeneratorRuntime").awrap(j(a,g));case 15:p.next=17;return c("nativePromiseRegeneratorRuntime").awrap(k(a,f));case 17:c("QPLUserFlow").addPoint(c("qpl")._(25305590,"1127"),"index_migration_end_success");case 18:case"end":return p.stop()}},null,this)},function(a){return f(a,"findIndicesToUpdateOrRemove")})["catch"](function(a){return f(a,"rebuildIndices")})}g.runMigrationForIndicesIfNeeded=a}),98);
__d("createReStoreEphemeralPersistence",["ReStorePersistence","TempLogForMessages","justknobx","nativePromiseRegeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function a(a){var b=new Map();function e(a){return h(b,a,function(){return new Map()})}return{flush:function(b){var f,g;return c("nativePromiseRegeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:if(!(a!=null)){h.next=5;break}f=a();h.next=4;return c("nativePromiseRegeneratorRuntime").awrap(f(b));case 4:return h.abrupt("return");case 5:g=!1,b.forEach(function(a,b){var f=e(b);a.forEach(function(a,e){d("ReStorePersistence").isDeletedValue(a)?(c("justknobx")._("86")&&b==="messages"&&(g=!0,d("TempLogForMessages").recordStorageIdSet(e,"-")),f["delete"](e)):(c("justknobx")._("86")&&b==="messages"&&(g=!0,d("TempLogForMessages").recordStorageIdSet(e.toString()+(a.isLeaf?" ("+JSON.stringify(a.children)+")":""),"+")),f.set(e,a))})}),c("justknobx")._("86")&&g&&d("TempLogForMessages").recordEndOfTxn();case 8:case"end":return h.stop()}},null,this)},get:function(a,b,c){a=e(b);return a.get(c)},releaseLockIfNeeded:function(){return Promise.resolve()},shouldSync:function(){return!1},waitForLock:function(){return Promise.resolve()}}}g["default"]=a}),98);
__d("ReQLBounds.bs",["LSDbKeyComparer.bs","bs_js_dict","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";function g(a,b,c){if(!b)return c;if(a<=0)return c;var d=b.hd;if(a===1)return{hd:d,tl:0};else return{hd:d,tl:g(a-1|0,b.tl,c)}}function a(a,c){return g(a,c,{hd:b("LSDbKeyComparer.bs").maxKey,tl:0})}function c(a,c){a=function(a){var b=a.NAME;if(b==="lessThan")return["lt",a.VAL];else if(b==="greaterThan")return["gt",a.VAL];else if(b==="greaterThanOrEqual")return["gte",a.VAL];else return["lte",a.VAL]};var d=c.NAME;if(d!=="range")if(d==="greaterThanOrEqual"||d==="greaterThan")return b("bs_js_dict").fromArray([a(c)]);else return b("bs_js_dict").fromArray([a(c)]);d=c.VAL;return b("bs_js_dict").fromArray([a(d[0]),a(d[1])])}function d(a){var c=a.operation;switch(c){case"add":return{_0:a.value,TAG:0};case"delete":return{_0:void 0,TAG:2};case"put":return{_0:a.value,TAG:1};default:return b("unrecoverableViolation")("Unexpected operation","messenger_web_product")}}f.concat=g;f.nextKey=a;f.mapBounds=c;f.mapEventToOperation=d}),null);
__d("IntervalList",["FBLogger","LSDbKeyComparer","ReQLBounds.bs","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a==null)throw c("FBLogger")("messenger_web_product").mustfixThrow("must not be null");return a}function a(a,c){var e=b("regeneratorRuntime").mark(k),f=new Map(),g=new Map(),i=new Map();function j(b,c){return c==null?!0:(c.gt!==void 0?a(b,c.gt)>0:c.gte!==void 0?a(b,c.gte)>=0:!0)&&(c.lt!==void 0?a(b,c.lt)<0:c.lte!==void 0?a(b,c.lte)<=0:!0)}function k(a){var h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;return b("regeneratorRuntime").wrap(function(b){while(1)switch(b.prev=b.next){case 0:h=a,i={hd:d("LSDbKeyComparer").MAX_KEY,tl:0},k=0;case 3:if(!(h!==0&&g.size)){b.next=33;break}k++;l=h;m=h.tl;h.tl=k<c?i:0;b.prev=8;n=g.get(JSON.stringify(a));if(!(n!=null)){b.next=27;break}o=n,p=Array.isArray(o),q=0,o=p?o:o[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();case 12:if(!p){b.next=18;break}if(!(q>=o.length)){b.next=15;break}return b.abrupt("break",27);case 15:r=o[q++];b.next=22;break;case 18:q=o.next();if(!q.done){b.next=21;break}return b.abrupt("break",27);case 21:r=q.value;case 22:s=r;b.next=25;return s;case 25:b.next=12;break;case 27:b.prev=27;l.tl=m;return b.finish(27);case 30:h=l.tl;b.next=3;break;case 33:t=f.entries(),u=Array.isArray(t),v=0,t=u?t:t[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();case 34:if(!u){b.next=40;break}if(!(v>=t.length)){b.next=37;break}return b.abrupt("break",52);case 37:w=t[v++];b.next=44;break;case 40:v=t.next();if(!v.done){b.next=43;break}return b.abrupt("break",52);case 43:w=v.value;case 44:x=w;y=x[0];z=x[1];if(!(f.has(y)&&j(a,z))){b.next=50;break}b.next=50;return y;case 50:b.next=34;break;case 52:case"end":return b.stop()}},e,this,[[8,,27,30]])}function l(a){var b=i.get(a);if(b!=null){i["delete"](a);var c=h(g.get(b));c["delete"](a);c.size===0&&g["delete"](b)}else f["delete"](a)}function m(a,b){var e;if(a&&a.gte!=null&&a.lte!=null&&(e=JSON.stringify(d("ReQLBounds.bs").nextKey(c,a.gte)))===JSON.stringify(a.lte)){var h=g.get(e);h==null&&(h=new Set(),g.set(e,h));h.add(b);i.set(b,e)}else f.set(b,a)}return{"delete":l,findIntersecting:k,set:m}}g["default"]=a}),98);
__d("createReStoreSubscriptionManager",["IntervalList","LSDbKeyComparer","LSStorage","Promise","cr:2281","killswitch","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,e){var f=new Map(),g=new Map();function h(a,c,d,e){return b("Promise").all(Array.from(a.findIntersecting(d)).map(function(a){return a(d,e,c)}))}function i(b){return c("nullthrows")((f.has(b)?f:f.set(b,[c("IntervalList")(d("LSDbKeyComparer").compareKey,a.tableNames[b].primaryKeyIds.length),new Map()])).get(b))}function j(b,e){var f=i(b);f[0];f=f[1];return c("nullthrows")((f.has(e)?f:f.set(e,c("IntervalList")(d("LSDbKeyComparer").compareKey,a.tableNames[b].indexes[e].length))).get(e))}function k(e,f,g,i,j,k){var l=function(a,b){return h(e,k,a,b)},m=g==null?void 0:d("LSStorage").searchKey(a,f,g,j),n=i==null?void 0:d("LSStorage").searchKey(a,f,i,j);if(n==null&&m!=null)return l(m,{operation:"delete",prevValue:g});if(m==null&&n!=null)return l(n,{operation:"add",value:c("nullthrows")(i)});return m!=null&&n!=null?d("LSDbKeyComparer").compareKey(m,n)===0?l(m,{operation:"put",prevValue:g,value:c("nullthrows")(i)}):l(m,{operation:"delete",prevValue:g}).then(function(){return l(n,{operation:"add",value:c("nullthrows")(i)})}):b("Promise").resolve()}function l(a,d,f,g,h){h===void 0&&(h=!1);!c("killswitch")("MESSENGER_WEB_PERSISTED_DB")&&h&&e(a)&&b("cr:2281")!=null&&b("cr:2281").postMessage("notifyTable",[a,d,f]);h=i(a);var j=h[0],l=h[1];return k(j,a,d,f,null,g).then(function(){return b("Promise").all(Array.from(l.entries()).map(function(b){var c=b[0];b=b[1];return k(b,a,d,f,c,g)}).filter(function(a){return a!=null}))})}function m(a){a===void 0&&(a=!1),!c("killswitch")("MESSENGER_WEB_PERSISTED_DB")&&a&&b("cr:2281")!=null&&b("cr:2281").postMessage("notifyCommit"),g.forEach(function(a){return a()})}!c("killswitch")("MESSENGER_WEB_PERSISTED_DB")&&b("cr:2281")!=null&&(b("cr:2281").onEventReceive("notifyTable",function(a){var b=a[0],d=a[1];a=a[2];var e=new WeakMap();c("promiseDone")(l(b,d,a,e,!1))}),b("cr:2281").onEventReceive("notifyCommit",function(a){m(!1)}));return{dispose:function(){f.clear(),g.clear()},notifyCommit:m,notifyTableAndIndexSubscribers:l,subscribeIndex:function(a,c,d,e){var f=j(a,c),g=!1,h=function(a,c,e){return g?b("Promise").resolve():d(a,c,e)};f.set(e,h);return function(){g=!0,f["delete"](h)}},subscribeTable:function(a,c,d){a=i(a);var e=a[0],f=!1,g=function(a,d,e){return f?b("Promise").resolve():c(a,d,e)};e.set(d,g);return function(){f=!0,e["delete"](g)}},subscribeToCommit:function(a){g.set(a,a);return function(){g["delete"](a)}}}}g["default"]=a}),98);
__d("LSJSInMemoryStorage.bs",["ReStore","createReStoreEphemeralPersistence"],(function(a,b,c,d,e,f){"use strict";function a(a){return b("ReStore")(b("createReStoreEphemeralPersistence")(),a)}f.make=a}),null);
__d("LSMailboxInitialSyncCursor",["I64","LSPlatformMessengerSyncParams","LSPlatformWorkplaceSyncParams","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";a=c("gkx")("1224637")?c("LSPlatformWorkplaceSyncParams").mailbox:c("LSPlatformMessengerSyncParams").mailbox;b=d("I64").of_int32(c("qex")._("461")===!0?3:1);e=d("I64").of_int32(0);g.syncParams=a;g.syncChannel=b;g.lastSyncTimestampMs=e}),98);
__d("LSSyncGroupsUtils",["CurrentLocale","LSIntEnum"],(function(a,b,c,d,e,f,g){"use strict";a={canIgnoreTimestamp:!1,currentCursor:void 0,dataTraceId:void 0,groupId:d("LSIntEnum").ofNumber(0),initTraceTimestampMs:void 0,lastSyncCompletedTimestampMs:void 0,lastSyncRequestTimestampMs:d("LSIntEnum").ofNumber(0),minTimeToSyncTimestampMs:d("LSIntEnum").ofNumber(-1),priority:d("LSIntEnum").ofNumber(0),regionHint:void 0,sendSyncParams:!0,syncChannel:d("LSIntEnum").ofNumber(1),syncParams:JSON.stringify({locale:c("CurrentLocale").get()}),syncStatus:d("LSIntEnum").ofNumber(0)};b={epochId:void 0,failureCount:d("LSIntEnum").ofNumber(0),lastDelayedRequestTimestampMs:void 0,lastSentTimestampMs:d("LSIntEnum").ofNumber(0),lastSyncRequestTimestampMs:d("LSIntEnum").ofNumber(0),networkTaskIdentifier:void 0,syncDatabaseId:d("LSIntEnum").ofNumber(0),taskQueueName:""};e=d("LSIntEnum").ofNumber(0);f=d("LSIntEnum").ofNumber(9999999999999);g.defaultSyncGroup=a;g.defaultNetworkRequest=b;g.initialEpochId=e;g.neverSyncTimestamp=f}),98);
__d("MNetRankType",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX_ACTIVE_NOW:0,MESSENGER_USER_SEARCH:1,MONTAGE_USER:2,BROADCAST_FLOW_TOP_CONTACTS:3,BROADCAST_FLOW_NEEDY_CONTACTS:4,MESSENGER_GROUP_SEARCH:5,RTC_TOP_CONTACTS:6,PSTN_TOP_CONTACTS:7,MESSENGER_NON_CONTACT_SEARCH:8,MESSENGER_SEARCH_BOOTSTRAP:9,ACTIVE_BEEPER:10,MONTAGE_AND_ACTIVE_NOW:11,MESSENGER_PAGE_SEARCH:12,MESSENGER_GAME_SEARCH:13,WWW_NULLSTATE:14,RTC_GROWTH:15,MESSENGER_OMNIPICKER_NULLSTATE:16,RTC_SEQUENTIAL_TOP_CONTACTS:17,MESSENGER_USER_SEARCH_NULLSTATE:18,MLITE_DIODE_PROMOTION:19,MESSENGER_PENDING_REQUEST:20,MESSENGER_CLOSE_CONNECTION:21,MESSENGER_MONTAGE_SEEN_SHEET:22,MESSENGER_OMNIPICKER_KEYPRESS:23,MESSENGER_NOTIF_QP_TARGETING_UPSELL_TYPE:24,CONTACT_TAB_ACTIVE_NOW:26,MESSENGER_UNIV_NULLSTATE_BLEND:27,MESSENGER_INBOX_THREADS:28,INBOX_ACTIVE_NOW_NO_BOOSTING:29,BROADCAST_FLOW_TOP_CONTACTS_FB_SHARE:30,BROADCAST_FLOW_TOP_CONTACTS_MESSENGER_SHARE:31,BROADCAST_FLOW_TOP_CONTACTS_EXTERNAL_SHARE:32,MESSENGER_TRENDING_STICKERS:33,MESSENGER_BROADCAST_FLOW_TOP_THREADS:34,MESSENGER_SENDS_28D:35,MESSENGER_ROOM_INVITE:36,MESSENGER_ROOM_INVITE_SEARCH:37,INBOX_ACTIVE_NOW_PREFETCH:38,MESSENGER_BLENDED_KEYPRESS:39,MESSENGER_BLENDED_NULLSTATE:40,MESSENGER_CARRIER_MESSAGING:41,MESSENGER_ROOM_INVITE_GROUP:42,MESSENGER_INBOX_BIRTHDAY_ITEM:43,INSTAGRAM_DIRECT_SEARCH_NULLSTATE:44,BROADCAST_FLOW_TOP_CONTACTS_AND_TOP_THREAD_FB_SHARE:45,BROADCAST_FLOW_TOP_THREADS_FB_SHARE:46,FB_H_SCROLL_RANKING:47,FB_MESSAGING_USER_SEARCH:48,FB_MESSAGING_USER_SEARCH_NULLSTATE:49,MESSENGER_ACTIVE_NOW_TRAY_ACTIVE_CC:50});f["default"]=a}),66);
__d("LSDefaultSyncGroups",["CurrentUser","I64","LSIntEnum","LSMailboxInitialSyncCursor","LSSyncGroupsUtils","MAWGating.re","MNetRankType","Promise","QPLUserFlow","ReQL","gkx","nativePromiseRegeneratorRuntime","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set();d("MAWGating.re").isArmadillo()&&d("MAWGating.re").isOccamadillo()&&!d("MAWGating.re").isOccamadilloResumeSyncEnabled()&&h.add(95);e=d("MAWGating.re").isArmadillo()&&d("MAWGating.re").isOccamadillo()?{groupId:95}:null;f=[{groupId:1,lastSyncRequestTimestampMs:d("LSMailboxInitialSyncCursor").lastSyncTimestampMs,syncChannel:d("LSMailboxInitialSyncCursor").syncChannel,syncParams:d("LSMailboxInitialSyncCursor").syncParams},{groupId:2,lastSyncRequestTimestampMs:d("LSMailboxInitialSyncCursor").lastSyncTimestampMs,syncChannel:d("LSMailboxInitialSyncCursor").syncChannel},{groupId:7,minTimeToSyncTimestampMs:d("LSSyncGroupsUtils").neverSyncTimestamp,syncParams:JSON.stringify({mnet_rank_types:[c("MNetRankType").MESSENGER_USER_SEARCH,c("MNetRankType").MESSENGER_USER_SEARCH_NULLSTATE,c("MNetRankType").INBOX_ACTIVE_NOW,c("MNetRankType").MESSENGER_OMNIPICKER_NULLSTATE]})},{groupId:15,minTimeToSyncTimestampMs:d("LSSyncGroupsUtils").neverSyncTimestamp},{groupId:12,minTimeToSyncTimestampMs:d("LSSyncGroupsUtils").neverSyncTimestamp},{groupId:16},{groupId:26},{groupId:5},{groupId:28},{groupId:118,minTimeToSyncTimestampMs:d("LSSyncGroupsUtils").neverSyncTimestamp},e,c("qex")._("274")||c("gkx")("1706")||c("gkx")("5849")?{groupId:6,minTimeToSyncTimestampMs:d("LSSyncGroupsUtils").neverSyncTimestamp}:null,c("gkx")("2250")?{groupId:108}:null];function i(a,e){var f,g;return c("nativePromiseRegeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return c("nativePromiseRegeneratorRuntime").awrap(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("network_requests")).getKeyRange("")));case 2:f=i.sent;g=f.map(function(a){a=a.syncDatabaseId;return d("LSIntEnum").toNumber(a)});return i.abrupt("return",b("Promise").all(e.map(function(b){return c("nativePromiseRegeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(!(b!=null&&(!g.includes(b.groupId)||h.has(b.groupId)))){e.next=3;break}e.next=3;return c("nativePromiseRegeneratorRuntime").awrap(a.table("network_requests").put(babelHelpers["extends"]({},d("LSSyncGroupsUtils").defaultNetworkRequest,{syncDatabaseId:d("LSIntEnum").ofNumber(b.groupId)})));case 3:case"end":return e.stop()}},null,this)})));case 5:case"end":return i.stop()}},null,this)}function j(a,e){var f,g,i;return c("nativePromiseRegeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:i=function(b){var e,f;return c("nativePromiseRegeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=b.groupId,f=babelHelpers.objectWithoutPropertiesLoose(b,["groupId"]);if(!(!g.includes(e)||h.has(e))){i.next=4;break}i.next=4;return c("nativePromiseRegeneratorRuntime").awrap(a.table("sync_groups").put(babelHelpers["extends"]({},d("LSSyncGroupsUtils").defaultSyncGroup,f,{groupId:d("LSIntEnum").ofNumber(e)})));case 4:case"end":return i.stop()}},null,this)};j.next=3;return c("nativePromiseRegeneratorRuntime").awrap(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("sync_groups"))));case 3:f=j.sent;g=f.map(function(a){a=a.groupId;return d("LSIntEnum").toNumber(a)});j.next=7;return c("nativePromiseRegeneratorRuntime").awrap(b("Promise").all(e.map(function(a){return a&&i(a)})));case 7:case"end":return j.stop()}},null,this)}function k(a){return a.table("_user_info").put({facebookUserId:d("I64").of_string(c("CurrentUser").getID()),id:d("LSIntEnum").ofNumber(1)})}function a(a,b,d){return c("nativePromiseRegeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c("QPLUserFlow").addPoint(c("qpl")._(25305590,"1127"),d?d+"_db_seed_starts":"db_seed_starts");e.next=3;return c("nativePromiseRegeneratorRuntime").awrap(k(a));case 3:e.next=5;return c("nativePromiseRegeneratorRuntime").awrap(i(a,b));case 5:e.next=7;return c("nativePromiseRegeneratorRuntime").awrap(j(a,b));case 7:c("QPLUserFlow").addPoint(c("qpl")._(25305590,"1127"),d?d+"_success_db_seed":"success_db_seed");case 8:case"end":return e.stop()}},null,this)}g.e2eeMetadataSyncGroup=e;g.defaultSyncGroups=f;g.seedDb=a}),98);
__d("MWLSSchemaEphemeral.bs",["LSDefaultSyncGroups","LSJSInMemoryStorage.bs","LSMetadata","LSTransaction.bs","Promise","QPLUserFlow","qpl"],(function(a,b,c,d,e,f){"use strict";function a(a){b("QPLUserFlow").addPoint(b("qpl")._(25305590,"1127"),"edb_init_starts");return b("Promise").resolve(b("LSJSInMemoryStorage.bs").make(b("LSMetadata").metadata)).then(function(a){return(b("QPLUserFlow").addPoint(b("qpl")._(25305590,"1127"),"success_edb_init"),b("LSTransaction.bs").run(a,function(a){return b("LSDefaultSyncGroups").seedDb(a,b("LSDefaultSyncGroups").defaultSyncGroups,"ephemeral")},"readWrite")).then(function(b){return a})})}f.createDB=a}),null);